<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- <link rel="icon" href="#"> -->

    <title>Profalaya</title>

    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <link href="/static/css/cover.css" rel="stylesheet">
    <style>
    /*body {
        padding: 20px;
        font-family: 'Open Sans', sans-serif;
        background-color: #f7f7f7;
    }*/

    .lib-panel {
        margin-bottom: 20Px;
    }
    .lib-panel img {
        width: 100%;
        background-color: transparent;
    }

    .lib-panel .row,
    .lib-panel .col-md-6 {
        padding: 0;
        background-color: #FFFFFF;
    }


    .lib-panel .lib-row {
        padding: 0 20px 0 20px;
    }

    .lib-panel .lib-row.lib-header {
        background-color: #FFFFFF;
        font-size: 20px;
        padding: 10px 20px 0 20px;
    }

    .lib-panel .lib-row.lib-header .lib-header-seperator {
        height: 2px;
        width: 26px;
        background-color: #d9d9d9;
        margin: 7px 0 7px 0;
    }

    .lib-panel .lib-row.lib-desc {
        position: relative;
        height: 100%;
        display: block;
        font-size: 13px;
    }
    .lib-panel .lib-row.lib-desc a{
        position: absolute;
        width: 100%;
        bottom: 10px;
        left: 20px;
    }

    .row-margin-bottom {
        margin-bottom: 20px;
    }

    .box-shadow {
        -webkit-box-shadow: 0 0 10px 0 rgba(0,0,0,.10);
        box-shadow: 0 0 10px 0 rgba(0,0,0,.10);
    }

    .no-padding {
        padding: 0;
    }
    .thumbnail {
      background: transparent;
    }
    img {
background: transparent;

  width: 150px;
  object-fit: cover;
  /*height: 50px;*/

}

    </style>

  </head>

  <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="masthead clearfix">
            <div class="inner">
              <h3 class="masthead-brand">Profalaya</h3>
              <nav>
                <ul class="nav masthead-nav">
                  <li class="active"><a href="#">Home</a></li>
                  <li><a href="#">Features</a></li>
                  <li><a href="#">Contact</a></li>
                </ul>
              </nav>
            </div>
          </div>

          <div class="inner cover">
            <h1 class="cover-heading">Worried about Research Internship in India?</h1>
            <p class="lead"> Search Professor Name, Research Topic, Project Topic and see the magic!</p>

            <form class="form-inline" id="search_form">
              <div class="form-group">
                <input type="text" class="form-control" id="search_query" required="true" placeholder="" size="50">
              </div>
              <button type="submit" class="btn btn-default">Search</button>
            </form>
          </div>

          <br>
          <br>
            <div id="result_section">


            </div>

            <div id="result_card" style="border:2px solid white;margin:1%;display:none">
              <div class="row">
                <div class="col-sm-3">
                  <a  class="thumbnail" style="margin:5%" >
                    <img id="prof_dp" class="img-responsive" src="/static/images/img_loading.gif" />
                  </a>
                </div>
                <div class="col-sm-8">
                  <h3 id="prof_name"></h3>
                  <h5 id="designation_department"></h5>
                  <em id="college_name"></em>
                  <br>
                  <br>
                  <button id="know_more" type="button" class="btn btn-default" name="button" onclick="openModal(this)">Know More <i class="glyphicon glyphicon-education"></i></button>
                </div>
              </div>
            </div>

              <!-- Modal -->
              <div class="" id="modal_section">
              <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-admin" style="width: 80%; padding-left: 20%;padding-top: 3%;">
                      <div class="modal-content" style="background:#333">
                          <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                              <h4 class="modal-title" id="myModalLabel">Professor Detail</h4>
                              </div>
                          <div class="modal-body">
                              <center>
                                <div class="row">
                                  <div class="col-sm-4">
                                    <img id="modal_img"src="/static/images/img_loading.gif" class="img-responsive"></a>
                                  </div>
                                  <div class="col-sm-7">
                                    <h3 id="modal_prof_name"class="media-heading"></h3>
                                    <h5 id="designation_department"></h5>
                                    <em id="college_name"></em>
                                    <br> <br>
                                    <p id="prof_email" >
                                    </p>
                                  </div>
                                </div>
                              </center>
                              <hr>
                              <center>
                              <p id="prof_area_of_interest" class="text-left"></p>
                              <br>
                              <p id="prof_profile_link" class="text-left"></p>
                              </center>
                          </div>
                          <div class="modal-footer">
                              <center>
                              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                              </center>
                          </div>
                      </div>
                  </div>
              </div>
            </div>

          <div class="mastfoot">
            <div class="inner">
              <p>AGS Productions &copy; 2017 </p>
            </div>
          </div>

        </div>

      </div>

    </div>
    <script src="/static/js/jquery.min.js" charset="utf-8"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script type="text/javascript">
// http://www.iitbhu.ac.in/mst/index.php/people/img8.jp

    var prof_data; //global variable

    function openModal(elem){
    // console.log("button clicked");
      var index_of_prof_in_prof_data = elem.id.slice(9);
      var prof = prof_data[index_of_prof_in_prof_data]
      console.log(prof);
      jQuery($("#myModal")).find("img").prop({src: prof['display_picture']});
      jQuery($("#myModal")).find("#modal_prof_name").prop({innerHTML: prof['name']});
      jQuery($("#myModal")).find("#prof_area_of_interest").prop({innerHTML: "<strong>Aria of interest: </strong><br>" + prof['area_of_interest']});
      jQuery($("#myModal")).find("#designation_department").prop({innerHTML: prof['designation']+", "+prof['department']});
      jQuery($("#myModal")).find("#college_name").prop({innerHTML : prof['college']});
      jQuery($("#myModal")).find("#prof_area_of_interest").prop({innerHTML: "<strong>Aria of interest: </strong><br>" + prof['area_of_interest']});
      jQuery($("#myModal")).find("#prof_email").prop({innerHTML: "<strong> Email: </strong> " + prof['email']});
      jQuery($("#myModal")).find("#prof_profile_link").prop({innerHTML: "<strong> Profile link: </strong><br>" + "<a href="+prof['profile_link']+ ' target="_blank" >Visit Profile</a>'});



prof_email
      $("#myModal").modal("show");

      }


    function load_img(){
      var downloadingImage = new Image();
      downloadingImage.onload = function(){

      };
      downloadingImage.onerror = function(){
        console.log("BC img load nhi hui!");
        img_srcs.push("#");
      }
      downloadingImage.src = display_picture;

    }
    $('#search_form').on('submit', function(event){
        event.preventDefault();
        $("#result_section").empty();
        // console.log("clicked");
        var val = $("#search_query").val();
        // console.log(val);

        $.ajax({
          url: 'search_query/',
          type: 'POST',
          dataType: 'json',
          data: {
          'search_query': val,
          'csrfmiddlewaretoken': '{{ csrf_token }}', },
          success: function(data) {
            // console.log(data);
            prof_data = JSON.parse(data['results'])
            count = data['result_count'];
            var img_srcs = [];
            for (i = 0; i<count; i++){
              // console.log("loop", i);
              // console.log(prof_data[i]);
              var card_data = prof_data[i];
              var id = card_data['id'];
              var name = card_data['name'];
              var college = card_data['college'];
              var department = card_data['department'];
              var designation = card_data['designation'];
              var display_picture = card_data['display_picture'];
              var email = card_data['email'];
              var profile_link = card_data['profile_link'];
              var phone = card_data['phone'];
              var area_of_interest = card_data['area_of_interest'];
              // console.log(name,college, department, display_picture,email, profile_link,phone, area_of_interest);
              // .appendTo('#result_section');
              var new_card = $('#result_card').clone().prop({ id: "result_card"+String(i)});
              jQuery(new_card).find("img").prop({id:"prof_dp"+String(i), src: '/static/images/na.png'});
              jQuery(new_card).find("h3").prop({id:"prof_name"+String(i), innerHTML: name});
              jQuery(new_card).find("h5").prop({id:"designation_department"+String(i), innerHTML: designation + ", " + department});
              jQuery(new_card).find("em").prop({id:"college_name"+String(i), innerHTML: college});
              var index_of_prof_in_prof_data = prof_data.indexOf(card_data)
              jQuery(new_card).find("button").prop({id:"know_more"+index_of_prof_in_prof_data});


              img_srcs.push(display_picture);
              new_card.css("display","block");
              new_card.appendTo('#result_section');


              // var new_modal = $("#myModal").clone().prop({id: "myModal"+String(i)})
              // jQuery(new_modal).find("modal_prof_name").prop({id:"modal_prof_name"+String(i), innerHTML:name});
              // jQuery(new_modal).find("modal_img").prop({id:"modal_img"+String(i), src:display_picture});
              //
              // new_modal.appendTo('#modal_section');

              $(".masthead").css("position","relative");
              $(".mastfoot").css("position","relative");

            }
            // console.log(img_srcs)
            // console.log(img_srcs);
                  preload(img_srcs);
           }

        })
        .done(function() {
          // console.log("success");
        })
        .fail(function() {
          // console.log("error");
        })
        .always(function() {
          // console.log("complete");
        });

            });
            function preload(arrayOfImages) {
              // console.log(arrayOfImages);
            for (x=0; x<arrayOfImages.length; x++){

              if(arrayOfImages[x]!=""){
                $("#prof_dp"+String(x)).css('background-color','white');
                $("#prof_dp"+String(x)).attr("src",arrayOfImages[x]);
              }

            }
      }

      // Usage:



    </script>
  </body>
</html>
